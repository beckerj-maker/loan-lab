<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loan Lab – Station A (Interest Accrual)</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <!-- React 18 UMD and Babel for in-browser JSX transform -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo } = React;

    /*** UI helpers ***/
    function NumberInput({ label, value, setValue, min = 0, step = 1, suffix = "" }) {
      return (
        <label className="block">
          <span className="text-sm text-gray-600">{label}</span>
          <div className="mt-1 flex items-center gap-2">
            <input
              type="number"
              value={value}
              min={min}
              step={step}
              onChange={(e) => setValue(Number(e.target.value))}
              className="w-full md:w-56 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black/30"
            />
            {suffix && <span className="text-gray-500 text-sm">{suffix}</span>}
          </div>
        </label>
      );
    }

    function Select({ label, value, setValue, options }) {
      return (
        <label className="block">
          <span className="text-sm text-gray-600">{label}</span>
          <select
            value={value}
            onChange={(e) => setValue(e.target.value)}
            className="mt-1 w-full md:w-56 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black/30"
          >
            {options.map((o) => (
              <option key={o.value} value={o.value}>
                {o.label}
              </option>
            ))}
          </select>
        </label>
      );
    }

    function Card({ title, children, footer }) {
      return (
        <div className="bg-white border rounded-2xl shadow-sm p-5">
          {title && <h3 className="text-lg font-semibold mb-3">{title}</h3>}
          <div>{children}</div>
          {footer && <div className="mt-4 pt-3 border-t text-sm text-gray-600">{footer}</div>}
        </div>
      );
    }

    function formatUSD(x) {
      try { return x.toLocaleString(undefined, { style: "currency", currency: "USD" }); }
      catch { return "$" + Number(x || 0).toFixed(2); }
    }

    /*** Correct simulations ***/
    // True monthly amortization with payment applied interest-first (typical installment loan)
    function simulateCompoundAmortization(principal, annualRate, monthlyPayment, months) {
      const i = annualRate / 12; // monthly rate as decimal
      let bal = principal;
      let totalInterest = 0;
      let negAm = false;

      for (let m = 1; m <= months; m++) {
        const interest = bal * i;
        totalInterest += interest;

        const principalPayment = monthlyPayment - interest;
        if (principalPayment < 0) {
          // Payment doesn't cover interest → unpaid interest adds to balance (negative amortization)
          negAm = true;
          bal = bal + (interest - monthlyPayment);
        } else {
          bal = Math.max(0, bal + interest - monthlyPayment);
        }

        if (bal <= 0) {
          return {
            balance: 0,
            totalInterest,
            monthsElapsed: m,
            negativeAmortization: negAm,
            paidOff: true
          };
        }
      }
      return {
        balance: Math.max(0, bal),
        totalInterest,
        monthsElapsed: months,
        negativeAmortization: negAm,
        paidOff: false
      };
    }

    // Pedagogical "simple-interest contrast": interest on ORIGINAL principal only (no interest-on-interest)
    function simulateSimpleContrast(principal, annualRate, monthlyPayment, months) {
      const i = annualRate / 12; // monthly rate
      let remainingPrincipal = principal;
      let accruedInterest = 0;
      let totalInterest = 0;

      for (let m = 1; m <= months; m++) {
        // Grow interest based ONLY on original principal
        accruedInterest += principal * i;

        // Payment applies to interest first, then principal
        let pay = monthlyPayment;

        const interestPaid = Math.min(pay, accruedInterest);
        pay -= interestPaid;
        accruedInterest -= interestPaid;
        totalInterest += interestPaid;

        remainingPrincipal = Math.max(0, remainingPrincipal - pay);

        if (remainingPrincipal === 0 && accruedInterest === 0) {
          return {
            balance: 0,
            totalInterest,
            monthsElapsed: m,
            negativeAmortization: false,
            paidOff: true
          };
        }
      }

      return {
        balance: remainingPrincipal + accruedInterest,
        totalInterest,
        monthsElapsed: months,
        negativeAmortization: false,
        paidOff: remainingPrincipal === 0 && accruedInterest === 0
      };
    }

    // Student-friendly outcome explainer
    function insightMessage(simSimple, simCompound) {
      const msgs = [];
      if (simCompound.negativeAmortization) {
        msgs.push("Your monthly payment is too small to even cover interest (negative amortization), so the compound loan’s balance grows.");
      }
      const diff = simCompound.totalInterest - simSimple.totalInterest;
      if (Math.abs(diff) < 1e-2) {
        msgs.push("Both models show similar total interest for these inputs.");
      } else if (diff > 0) {
        msgs.push("Compound shows higher total interest than the simple-contrast model because interest accrues on a changing balance and your payment is relatively low, letting more interest build up.");
      } else {
        msgs.push("Compound shows lower total interest than the simple-contrast model because payments reduce the balance quickly; interest is charged on a shrinking balance, while the simple-contrast model always charges interest on the original principal.");
      }
      msgs.push("Reminder: the simple panel is a teaching contrast, not a real loan type; real installment loans behave like the compound (amortized) panel.");
      return msgs;
    }

    /*** Main component ***/
    function StationA() {
      const [principal, setPrincipal] = useState(5000);
      const [ratePct, setRatePct] = useState(6);
      const [years, setYears] = useState(3);
      const [compFreq, setCompFreq] = useState("annual"); // for closed-form model
      const [monthlyPay, setMonthlyPay] = useState(100);

      const r = ratePct / 100;
      const n = compFreq === "annual" ? 1 : compFreq === "monthly" ? 12 : 365;

      // Closed-form models (for the formulas section)
      const simpleInterest = useMemo(() => principal * r * years, [principal, r, years]);
      const simpleTotal = principal + simpleInterest;

      const compoundTotal = useMemo(
        () => principal * Math.pow(1 + r / n, n * years),
        [principal, r, n, years]
      );
      const compoundInterest = compoundTotal - principal;

      // Simulations (month-by-month)
      const months = Math.max(1, Math.round(years * 12));

      const simCompound = useMemo(
        () => simulateCompoundAmortization(principal, r, monthlyPay, months),
        [principal, r, monthlyPay, months]
      );

      const simSimple = useMemo(
        () => simulateSimpleContrast(principal, r, monthlyPay, months),
        [principal, r, monthlyPay, months]
      );

      return (
        <div className="min-h-screen bg-gray-50 max-w-6xl mx-auto px-4 py-8 space-y-6">
          <h2 className="text-2xl md:text-3xl font-bold">Station A: Interest Accrual Challenge</h2>
          <p className="text-gray-600 max-w-3xl">
            Interest is the price you pay to borrow money. With <strong>simple interest</strong>, you pay interest only on the
            original amount (principal). With <strong>compound interest</strong>, you also pay interest on previously-added
            interest—this makes balances grow faster when you don’t keep up with payments.
          </p>

          <Card title="Set Up Your Scenario">
            <div className="grid md:grid-cols-3 gap-4">
              <NumberInput label="Principal" value={principal} setValue={setPrincipal} step={100} suffix="USD" />
              <NumberInput label="Annual Interest Rate" value={ratePct} setValue={setRatePct} step={0.25} suffix="%" />
              <NumberInput label="Years" value={years} setValue={setYears} step={0.5} />
              <Select
                label="Compounding Frequency (for compound model)"
                value={compFreq}
                setValue={setCompFreq}
                options={[
                  { value: "annual", label: "Annual" },
                  { value: "monthly", label: "Monthly" },
                  { value: "daily", label: "Daily (365)" },
                ]}
              />
              <NumberInput label="Monthly Payment (for simulation)" value={monthlyPay} setValue={setMonthlyPay} step={10} suffix="/mo" />
            </div>
          </Card>

          <div className="grid md:grid-cols-2 gap-6">
            <Card title="Simple Interest (Closed-Form Model)">
              <ul className="space-y-2 text-sm">
                <li>Formula: <code>Interest = Principal × Rate × Time</code></li>
                <li>Principal: <strong>{formatUSD(principal)}</strong></li>
                <li>Rate: <strong>{ratePct}%</strong> per year</li>
                <li>Time: <strong>{years}</strong> years</li>
                <li className="mt-2">Total Interest: <strong>{formatUSD(simpleInterest)}</strong></li>
                <li>Total to Repay: <strong>{formatUSD(simpleTotal)}</strong></li>
              </ul>
            </Card>

            <Card title="Compound Interest (Closed-Form Model)">
              <ul className="space-y-2 text-sm">
                <li>Formula: <code>A = P × (1 + r/n)^(n×t)</code></li>
                <li>Principal: <strong>{formatUSD(principal)}</strong></li>
                <li>Rate: <strong>{ratePct}%</strong> per year</li>
                <li>Compounds per year: <strong>{n}</strong></li>
                <li>Time: <strong>{years}</strong> years</li>
                <li className="mt-2">Total Interest: <strong>{formatUSD(compoundInterest)}</strong></li>
                <li>Total to Repay: <strong>{formatUSD(compoundTotal)}</strong></li>
              </ul>
            </Card>
          </div>

          <Card title="Model the Math – Step by Step (Yearly Compounding Example)">
            <ol className="list-decimal pl-6 space-y-2 text-sm">
              <li>Start: <strong>{formatUSD(principal)}</strong></li>
              <li>End of Year 1: add {ratePct}% → {formatUSD(principal * (1 + r))}</li>
              <li>End of Year 2: add {ratePct}% → {formatUSD(principal * Math.pow(1 + r, 2))}</li>
              <li>End of Year 3: add {ratePct}% → {formatUSD(principal * Math.pow(1 + r, 3))}</li>
            </ol>
            <p className="mt-3 text-gray-600 text-sm">
              (Use the compounding frequency selector above to explore how changing from annual to monthly or daily alters the total.)
            </p>
          </Card>

          <div className="grid md:grid-cols-2 gap-6">
            <Card title="What if I only pay this much each month? (Simulations)">
              <p className="text-sm text-gray-600 mb-2">
                These simulations compare a simple-interest contrast vs a typical amortized (compound) loan.
              </p>
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <div className="font-semibold mb-1">Simple (contrast)</div>
                  <div className="text-gray-600">Estimated balance after {months} months</div>
                  <div className="text-xl font-bold">{formatUSD(simSimple.balance)}</div>
                  <div className="text-gray-600 mt-1">Total interest paid: {formatUSD(simSimple.totalInterest)}</div>
                  {simSimple.paidOff && (
                    <div className="text-green-700 mt-1">Paid off in {simSimple.monthsElapsed} months</div>
                  )}
                </div>
                <div>
                  <div className="font-semibold mb-1">Compound (amortized)</div>
                  <div className="text-gray-600">Estimated balance after {months} months</div>
                  <div className="text-xl font-bold">{formatUSD(simCompound.balance)}</div>
                  <div className="text-gray-600 mt-1">Total interest paid: {formatUSD(simCompound.totalInterest)}</div>
                  {simCompound.negativeAmortization && (
                    <div className="text-amber-700 mt-1">Warning: payment is too small (negative amortization)</div>
                  )}
                  {simCompound.paidOff && (
                    <div className="text-green-700 mt-1">Paid off in {simCompound.monthsElapsed} months</div>
                  )}
                </div>
              </div>
              <div className="mt-3 text-xs text-gray-500">
                Note: “Simple (contrast)” shows interest on the original principal only (no interest-on-interest) to highlight the difference.
                “Compound (amortized)” models a typical installment loan with monthly interest applied to the current balance.
              </div>
            </Card>

            <Card title="Quick Checks">
              <ol className="list-decimal pl-6 space-y-3 text-sm">
                <li>Which total is bigger: simple or compound? Why?</li>
                <li>How does increasing compounding frequency (annual → monthly → daily) affect the total?</li>
                <li>For the same loan, what happens if you increase your monthly payment?</li>
              </ol>
            </Card>
          </div>

          <!-- Outcome Insight -->
          <Card title="Outcome Insight">
            <ul className="list-disc pl-6 text-sm text-gray-700">
              {insightMessage(simSimple, simCompound).map((t, i) => (
                <li key={i}>{t}</li>
              ))}
            </ul>
          </Card>

          <Card title="Reflection (Write 2–3 sentences)">
            <p className="text-sm">
              Why might compound interest be especially dangerous for student loans or credit cards?
              What are two smart strategies to keep interest costs down?
            </p>
          </Card>
        </div>
      );
    }

    function App() { return <StationA />; }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
